from modules.get_pois_util import get_filter_from_llm
from modules.common.poi_metadata import get_reviews
from modules.route_optim_util import get_scores_from_llm
from components.user_request_data import UserRequest, Duration, Kwargs
from components.poi_data import Place, Geometry, OpeningHours, Photos
from modules.common.route_optimizer import optimize_route
import json
from modules.common.llm_request import request_to_llm
from modules.common.get_pois_from_map import extract_pois
from typing import List
import csv
from components.user_request_data import UserRequest
from modules.get_pois_util import save_pois
from modules.route_optim_util import load_pois

user_data = UserRequest(
                     user_id='',
                     location='Tokyo',
                     duration=Duration(start='2025-05-27', end='2025-05-29'),
                     companions=2,
                     concept='cultural sites and heritage attractions',
                     extra_request="i want to enjoy tokyo's culture like foods and other places that represent tokyo",
                     kwargs=Kwargs(filter=None, prev_map_data=None, cache_key=None))

filter=[
    {"id": 13062, "query": "popular night markets near me"},
    {"id": 13065, "query": "famous local restaurants"},
    {"id": 13338, "query": "best seafood restaurants in the area"},
    {"id": 14009, "query": "top marketplaces to explore"}
]
pois = {'base': [Place(name='Senso-ji Temple', place_id='4b0587a1f964a5207f9d22e3', vicinity=None, geometry=Geometry(lat=35.7145, lng=139.7966), categories=['Temple', 'Historical Site'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Tsukiji Fish Market', place_id='4b57cb7cf964a5208b4128e3', vicinity=None, geometry=Geometry(lat=35.6655, lng=139.7707), categories=['Market', 'Culinary Experience'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Meiji Shrine', place_id='4b5bd0a2f964a520c31729e3', vicinity=None, geometry=Geometry(lat=35.6764, lng=139.6993), categories=['Shrine', 'Historical Site'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Akihabara Electric Town', place_id='5037263ae4b02090b3468997', vicinity=None, geometry=Geometry(lat=35.6997, lng=139.7711), categories=['Shopping District', 'Tech Hub'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Tokyo Tower', place_id='625521c9f8a2661187d954e9', vicinity=None, geometry=Geometry(lat=35.6586, lng=139.7454), categories=['Landmark', 'Observation Deck'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Harajuku District', place_id='4b56d3b2f964a520471c28e3', vicinity=None, geometry=Geometry(lat=35.6717, lng=139.7035), categories=['Fashion', 'Street Food'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None)], 'sub': [Place(name='Restaurant Sakaki (レストラン サカキ)', place_id='4c2c11a3d1a10f479009f964', vicinity=None, geometry=Geometry(lat=35.67598, lng=139.771477), categories=['French Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Club of Tokyo Famous Curry Diners (東京カレー屋名店会)', place_id='4fb862ade4b0fdfd00965d8f', vicinity=None, geometry=Geometry(lat=35.710027, lng=139.810728), categories=['Japanese Curry Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Asakusa Local Burger (アサクサ ローカル バーガー)', place_id='5cbbf555a0215b002ccde0da', vicinity=None, geometry=Geometry(lat=35.716006, lng=139.798396), categories=['Burger Joint'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="Noguchi's Best Fish (野口鮮魚店)", place_id='4dc8d9fbb0fbf26798be503f', vicinity=None, geometry=Geometry(lat=35.706324, lng=139.805593), categories=['Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Uotake (魚竹)', place_id='4b591942f964a520747c28e3', vicinity=None, geometry=Geometry(lat=35.669447, lng=139.771712), categories=['Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='浅草魚料理遠州屋', place_id='4b83493df964a520cc0031e3', vicinity=None, geometry=Geometry(lat=35.709025, lng=139.79065), categories=['Bar', 'Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Restaurant Sakaki (レストラン サカキ)', place_id='4c2c11a3d1a10f479009f964', vicinity=None, geometry=Geometry(lat=35.67598, lng=139.771477), categories=['French Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="FREY's Famous Pizzeria", place_id='4d9bef117ae5548188c14274', vicinity=None, geometry=Geometry(lat=35.665126, lng=139.732576), categories=['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='RESTAURANT SANGAM TSUKIJI', place_id='8478893c401549ac7025d5a0', vicinity=None, geometry=Geometry(lat=35.665051, lng=139.775597), categories=['Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Uotake (魚竹)', place_id='4b591942f964a520747c28e3', vicinity=None, geometry=Geometry(lat=35.669447, lng=139.771712), categories=['Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Motodane (本種)', place_id='4c789657bd346dcb51e3f2ef', vicinity=None, geometry=Geometry(lat=35.664702, lng=139.771932), categories=['Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Tuna wholesale tuna bowl shop (マグロ卸のフッシャリーズテラス)', place_id='5764b1f2498ebe1c97b3e2dc', vicinity=None, geometry=Geometry(lat=35.652561, lng=139.771431), categories=['Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="FREY's Famous Pizzeria", place_id='4d9bef117ae5548188c14274', vicinity=None, geometry=Geometry(lat=35.665126, lng=139.732576), categories=['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Locale', place_id='59e748bfacc5f52d252e66c9', vicinity=None, geometry=Geometry(lat=35.636221, lng=139.709431), categories=['French Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Bakery Restaurant Saint Marc (ベーカリーレストラン サンマルク)', place_id='4d12cc1dffa1224b3a1a9cad', vicinity=None, geometry=Geometry(lat=35.692452, lng=139.69852), categories=['Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Takamaru Sengyoten (タカマル鮮魚店)', place_id='4ba04744f964a520dc6537e3', vicinity=None, geometry=Geometry(lat=35.695015, lng=139.697878), categories=['Bar', 'Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Takamaru Sengyoten (タカマル鮮魚店 4号店)', place_id='555c0cf5498eb932081d33ba', vicinity=None, geometry=Geometry(lat=35.697611, lng=139.697376), categories=['Seafood Restaurant', 'Sake Bar', 'Japanese Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Udagawacho Uokin (宇田川町魚金)', place_id='5733421e498e0abe0d0c261a', vicinity=None, geometry=Geometry(lat=35.662652, lng=139.696899), categories=['Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Restaurant Sakaki (レストラン サカキ)', place_id='4c2c11a3d1a10f479009f964', vicinity=None, geometry=Geometry(lat=35.67598, lng=139.771477), categories=['French Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="FREY's Famous Pizzeria", place_id='4d9bef117ae5548188c14274', vicinity=None, geometry=Geometry(lat=35.665126, lng=139.732576), categories=['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Indian Asian Restaurant SAKURA', place_id='5711a8a1498e0859ea9c81e0', vicinity=None, geometry=Geometry(lat=35.70268, lng=139.782178), categories=['Indian Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='北海道シントク町塚田農場秋葉原万世橋店', place_id='564f1ba0498e317225e719fb', vicinity=None, geometry=Geometry(lat=35.697303, lng=139.771451), categories=['Sake Bar', 'Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="Noguchi's Best Fish (野口鮮魚店)", place_id='4dc8d9fbb0fbf26798be503f', vicinity=None, geometry=Geometry(lat=35.706324, lng=139.805593), categories=['Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Kagurazaka Uokin (神楽坂魚金)', place_id='53e0d63f498eba8c631b23d3', vicinity=None, geometry=Geometry(lat=35.701938, lng=139.741563), categories=['Bar', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="FREY's Famous Pizzeria", place_id='4d9bef117ae5548188c14274', vicinity=None, geometry=Geometry(lat=35.665126, lng=139.732576), categories=['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Restaurant Sakaki (レストラン サカキ)', place_id='4c2c11a3d1a10f479009f964', vicinity=None, geometry=Geometry(lat=35.67598, lng=139.771477), categories=['French Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Locale', place_id='59e748bfacc5f52d252e66c9', vicinity=None, geometry=Geometry(lat=35.636221, lng=139.709431), categories=['French Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Tuna wholesale tuna bowl shop (マグロ卸のフッシャリーズテラス)', place_id='5764b1f2498ebe1c97b3e2dc', vicinity=None, geometry=Geometry(lat=35.652561, lng=139.771431), categories=['Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Uoshin (魚真)', place_id='4b336340f964a5200d1925e3', vicinity=None, geometry=Geometry(lat=35.666828, lng=139.728064), categories=['Bar', 'Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='新橋魚金六本木店', place_id='56d6e30acd1067216fdd3201', vicinity=None, geometry=Geometry(lat=35.665465, lng=139.728654), categories=['Bar', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name="FREY's Famous Pizzeria", place_id='4d9bef117ae5548188c14274', vicinity=None, geometry=Geometry(lat=35.665126, lng=139.732576), categories=['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Locale', place_id='59e748bfacc5f52d252e66c9', vicinity=None, geometry=Geometry(lat=35.636221, lng=139.709431), categories=['French Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Restaurant Sakaki (レストラン サカキ)', place_id='4c2c11a3d1a10f479009f964', vicinity=None, geometry=Geometry(lat=35.67598, lng=139.771477), categories=['French Restaurant', 'Yoshoku Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Udagawacho Uokin (宇田川町魚金)', place_id='5733421e498e0abe0d0c261a', vicinity=None, geometry=Geometry(lat=35.662652, lng=139.696899), categories=['Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Takamaru Sengyoten (タ カマル鮮魚店)', place_id='4ba04744f964a520dc6537e3', vicinity=None, geometry=Geometry(lat=35.695015, lng=139.697878), categories=['Bar', 'Japanese Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None), Place(name='Uoshin (魚真)', place_id='4b336340f964a5200d1925e3', vicinity=None, geometry=Geometry(lat=35.666828, lng=139.728064), categories=['Bar', 'Sushi Restaurant', 'Seafood Restaurant'], rating=None, user_ratings_total=None, opening_hours=None, photos=None, icon=None)]}

scores={'base': [{'name': 'Senso-ji Temple', 'latitude': 35.7145, 'longitude': 139.7966, 'score': 7.266666666666667, 'category': ['Temple', 'Historical Site']}, {'name': 'Tsukiji Fish Market', 'latitude': 35.6655, 'longitude': 139.7707, 'score': 7.541666666666667, 'category': ['Market', 'Culinary Experience']}, {'name': 'Meiji Shrine', 'latitude': 35.6764, 'longitude': 139.6993, 'score': 8.28, 'category': ['Shrine', 'Historical Site']}, {'name': 'Akihabara Electric Town', 'latitude': 35.6997, 'longitude': 139.7711, 'score': 6.666666666666667, 'category': ['Shopping District', 'Tech Hub']}, {'name': 'Tokyo Tower', 'latitude': 35.6586, 'longitude': 139.7454, 'score': 7.5, 'category': ['Landmark', 'Observation Deck']}, {'name': 'Harajuku District', 'latitude': 35.6717, 'longitude': 139.7035, 'score': 7.92, 'category': ['Fashion', 'Street Food']}], 'sub': [{'name': 'Restaurant Sakaki (レストラン サカキ)', 'latitude': 35.67598, 'longitude': 139.771477, 'score': 4.6, 'category': ['French Restaurant', 'Yoshoku Restaurant']}, {'name': 'Club of Tokyo Famous Curry Diners (東京カレー屋名店会)', 'latitude': 35.710027, 'longitude': 139.810728, 'score': 8.25, 'category': ['Japanese Curry Restaurant']}, {'name': 'Asakusa Local Burger (アサクサ ローカル バーガー)', 'latitude': 35.716006, 'longitude': 139.798396, 'score': 7.6, 'category': ['Burger Joint']}, {'name': "Noguchi's Best Fish (野口鮮魚店)", 'latitude': 35.706324, 'longitude': 139.805593, 'score': 6.222222222222222, 'category': ['Sushi Restaurant', 'Seafood Restaurant']}, {'name': 'Uotake (魚竹)', 'latitude': 35.669447, 'longitude': 139.771712, 'score': 6.25, 'category': ['Sushi Restaurant', 'Seafood Restaurant']}, {'name': '浅草魚料理遠州屋', 'latitude': 35.709025, 'longitude': 139.79065, 'score': 6.0, 'category': ['Bar', 'Sushi Restaurant', 'Seafood Restaurant']}, {'name': 'Restaurant Sakaki (レストラン サカキ)', 'latitude': 35.67598, 'longitude': 139.771477, 'score': 3.8, 'category': ['French Restaurant', 'Yoshoku Restaurant']}, {'name': "FREY's Famous Pizzeria", 'latitude': 35.665126, 'longitude': 139.732576, 'score': 3.4444444444444446, 'category': ['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant']}, {'name': 'RESTAURANT SANGAM TSUKIJI', 'latitude': 35.665051, 'longitude': 139.775597, 'score': 8.25, 'category': ['Restaurant']}, {'name': 'Uotake (魚竹)', 'latitude': 35.669447, 'longitude': 139.771712, 'score': 7.333333333333333, 'category': ['Sushi Restaurant', 'Seafood Restaurant']}, {'name': 'Motodane (本種)', 'latitude': 35.664702, 'longitude': 139.771932, 'score': 6.111111111111111, 'category': ['Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Tuna wholesale tuna bowl shop (マグロ卸のフッシャリーズテラス)', 'latitude': 35.652561, 'longitude': 139.771431, 'score': 6.166666666666667, 'category': ['Japanese Restaurant', 'Seafood Restaurant']}, {'name': "FREY's Famous Pizzeria", 'latitude': 35.665126, 'longitude': 139.732576, 'score': 5.8, 'category': ['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant']}, {'name': 'Locale', 'latitude': 35.636221, 'longitude': 139.709431, 'score': 2.5, 'category': ['French Restaurant']}, {'name': 'Bakery Restaurant Saint Marc (ベーカリーレストラン サンマルク)', 'latitude': 35.692452, 'longitude': 139.69852, 'score': 6.428571428571429, 'category': ['Restaurant']}, {'name': 'Takamaru Sengyoten (タカマル鮮魚店)', 'latitude': 35.695015, 'longitude': 139.697878, 'score': 7.7272727272727275, 'category': ['Bar', 'Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Takamaru Sengyoten (タカマル鮮魚店 4号店)', 'latitude': 35.697611, 'longitude': 139.697376, 'score': 5.2727272727272725, 'category': ['Seafood Restaurant', 'Sake Bar', 'Japanese Restaurant']}, {'name': 'Udagawacho Uokin (宇田川町魚金)', 'latitude': 35.662652, 'longitude': 139.696899, 'score': 7.5, 'category': ['Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Restaurant Sakaki (レストラン サカキ)', 'latitude': 35.67598, 'longitude': 139.771477, 'score': 3.4, 'category': ['French Restaurant', 'Yoshoku Restaurant']}, {'name': "FREY's Famous Pizzeria", 'latitude': 35.665126, 'longitude': 139.732576, 'score': 4.0, 'category': ['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant']}, {'name': 'Indian Asian Restaurant SAKURA', 'latitude': 35.70268, 'longitude': 139.782178, 'score': 2.0, 'category': ['Indian Restaurant']}, {'name': '北海道シントク町塚田農場秋葉原万世橋店', 'latitude': 35.697303, 'longitude': 139.771451, 'score': 6.0, 'category': ['Sake Bar', 'Japanese Restaurant', 'Seafood Restaurant']}, {'name': "Noguchi's Best Fish (野口鮮魚店)", 'latitude': 35.706324, 'longitude': 139.805593, 'score': 6.222222222222222, 'category': ['Sushi Restaurant', 'Seafood Restaurant']}, {'name': 'Kagurazaka Uokin (神楽坂魚金)', 'latitude': 35.701938, 'longitude': 139.741563, 'score': 7.5, 'category': ['Bar', 'Seafood Restaurant']}, {'name': "FREY's Famous Pizzeria", 'latitude': 35.665126, 'longitude': 139.732576, 'score': 2.15, 'category': ['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant']}, {'name': 'Restaurant Sakaki (レストラン サカキ)', 'latitude': 35.67598, 'longitude': 139.771477, 'score': 3.6, 'category': ['French Restaurant', 'Yoshoku Restaurant']}, {'name': 'Locale', 'latitude': 35.636221, 'longitude': 139.709431, 'score': 1.25, 'category': ['French Restaurant']}, {'name': 'Tuna wholesale tuna bowl shop (マグロ卸のフッシャリーズテラス)', 'latitude': 35.652561, 'longitude': 139.771431, 'score': 4.666666666666667, 'category': ['Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Uoshin (魚真)', 'latitude': 35.666828, 'longitude': 139.728064, 'score': 7.8, 'category': ['Bar', 'Sushi Restaurant', 'Seafood Restaurant']}, {'name': '新橋魚金六本木店', 'latitude': 35.665465, 'longitude': 139.728654, 'score': 8.5, 'category': ['Bar', 'Seafood Restaurant']}, {'name': "FREY's Famous Pizzeria", 'latitude': 35.665126, 'longitude': 139.732576, 'score': 3.75, 'category': ['Pizzeria', 'Italian Restaurant', 'Yoshoku Restaurant']}, {'name': 'Locale', 'latitude': 35.636221, 'longitude': 139.709431, 'score': 1.75, 'category': ['French Restaurant']}, {'name': 'Restaurant Sakaki (レストラン サカキ)', 'latitude': 35.67598, 'longitude': 139.771477, 'score': 4.6, 'category': ['French Restaurant', 'Yoshoku Restaurant']}, {'name': 'Udagawacho Uokin (宇田川町魚金)', 'latitude': 35.662652, 'longitude': 139.696899, 'score': 6.5, 'category': ['Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Takamaru Sengyoten (タ カマル鮮魚店)', 'latitude': 35.695015, 'longitude': 139.697878, 'score': 7.875, 'category': ['Bar', 'Japanese Restaurant', 'Seafood Restaurant']}, {'name': 'Uoshin (魚真)', 'latitude': 35.666828, 'longitude': 139.728064, 'score': 7.9523809523809526, 'category': ['Bar', 'Sushi Restaurant', 'Seafood Restaurant']}]}

route = optimize_route(user_data.user_id, user_data.duration, scores,4)
print(route)